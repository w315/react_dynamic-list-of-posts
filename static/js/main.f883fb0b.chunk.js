(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{17:function(e,t,s){},19:function(e,t,s){},20:function(e,t,s){"use strict";s.r(t);var n=s(1),c=s.n(n),a=s(9),i=s.n(a),o=(s(15),s(16),s(17),s(3)),l=s.n(o),r=s(2),d=s(0),m=Object(n.createContext)(void 0);if(void 0===m)throw new Error("useUser must be used within a UserProvider");var j=function(e){var t=e.children,s=Object(n.useState)(null),c=Object(r.a)(s,2),a=c[0],i=c[1],o=Object(n.useState)(null),l=Object(r.a)(o,2),j=l[0],u=l[1],b=Object(n.useState)([]),h=Object(r.a)(b,2),O=h[0],v=h[1],f=Object(n.useState)(null),x=Object(r.a)(f,2),p=x[0],N=x[1],y=Object(n.useState)([]),g=Object(r.a)(y,2),S=g[0],C=g[1],E=Object(n.useState)(null),w=Object(r.a)(E,2),P=w[0],k=w[1],L=Object(n.useState)(!1),U=Object(r.a)(L,2),I=U[0],T=U[1],F=Object(n.useState)(""),D=Object(r.a)(F,2),B=D[0],M=D[1],A=Object(n.useState)(""),_=Object(r.a)(A,2),J=_[0],q=_[1],W=Object(n.useState)(""),G=Object(r.a)(W,2),R=G[0],Y=G[1],z=Object(n.useState)(!1),H=Object(r.a)(z,2),K=H[0],Q=H[1],V=Object(n.useState)(!1),X=Object(r.a)(V,2),Z=X[0],$=X[1],ee=Object(n.useState)(!1),te=Object(r.a)(ee,2),se=te[0],ne=te[1],ce=Object(n.useState)(!1),ae=Object(r.a)(ce,2),ie={users:a,setUsers:i,showUsers:I,setShowUsers:T,userSelected:j,setUserSelected:u,errorPosts:B,setErrorPosts:M,isLoadingPosts:K,setIsLoadingPosts:Q,posts:O,setPosts:v,postSelected:p,setPostSelected:N,errorUsers:J,setErrorUsers:q,comments:S,setComments:C,errorComments:R,setErrorComments:Y,isLoadingComments:Z,setIsLoadingComments:$,commentToDelete:P,setCommentToDelete:k,showForm:ae[0],setShowForm:ae[1],isLoadingCommentSending:se,setIsLoadingCommentSending:ne};return Object(d.jsx)(m.Provider,{value:ie,children:t})},u=function(){var e=Object(n.useContext)(m);if(void 0===e)throw new Error("useUser must be used within a UserProvider");return e},b="https://mate.academy/students-api";function h(e){return new Promise((function(t){setTimeout(t,e)}))}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:t};return s&&(n.body=JSON.stringify(s),n.headers={"Content-Type":"application/json; charset=UTF-8"}),h(300).then((function(){return fetch(b+e,n)})).then((function(e){return e.json()}))}var v=function(e){return O(e)},f=function(e,t){return O(e,"POST",t)},x=function(e){return O(e,"DELETE")},p=function(){var e=u(),t=e.posts,s=e.setPosts,c=e.setErrorPosts,a=e.userSelected,i=e.setIsLoadingPosts,o=e.setPostSelected,r=e.postSelected;return Object(n.useEffect)((function(){a&&(i(!0),s([]),o(null),v("/posts?userId=".concat(null===a||void 0===a?void 0:a.id)).then((function(e){s(e)})).catch((function(){c("Error loading posts")})).finally((function(){i(!1)})))}),[a]),Object(d.jsx)(d.Fragment,{children:0!==(null===t||void 0===t?void 0:t.length)&&a&&Object(d.jsxs)("div",{"data-cy":"PostsList",children:[Object(d.jsx)("p",{className:"title",children:"Posts:"}),Object(d.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{className:"has-background-link-light",children:[Object(d.jsx)("th",{children:"#"}),Object(d.jsx)("th",{children:"Title"}),Object(d.jsx)("th",{children:" "})]})}),Object(d.jsx)("tbody",{children:null===t||void 0===t?void 0:t.map((function(e){return Object(d.jsxs)("tr",{"data-cy":"Post",children:[Object(d.jsx)("td",{"data-cy":"PostId",children:e.id}),Object(d.jsx)("td",{"data-cy":"PostTitle",children:e.title}),Object(d.jsx)("td",{className:"has-text-right is-vcentered",children:Object(d.jsx)("button",{type:"button","data-cy":"PostButton",className:l()("button","is-link",{"is-light":e.id!==(null===r||void 0===r?void 0:r.id)}),onClick:function(){return function(e){(null===r||void 0===r?void 0:r.id)===e.id?o(null):o(e)}(e)},children:"Open"})})]},e.id)}))})]})]})})},N=(s(19),function(){return Object(d.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(d.jsx)("div",{className:"Loader__content"})})}),y=s(10),g=s(6),S=s(8),C=function(){var e=u(),t=e.comments,s=e.setUsers,c=e.setComments,a=e.postSelected,i=e.isLoadingCommentSending,o=e.setIsLoadingCommentSending,m=Object(n.useState)(!1),j=Object(r.a)(m,2),b=j[0],h=j[1],O=Object(n.useState)(!1),v=Object(r.a)(O,2),x=v[0],p=v[1],N=Object(n.useState)(!1),C=Object(r.a)(N,2),E=C[0],w=C[1],P=Object(n.useState)({name:"",email:"",body:"",postId:null===a||void 0===a?void 0:a.id}),k=Object(r.a)(P,2),L=k[0],U=k[1],I=function(e){var t=e.target,s=t.name,n=t.value;switch(s){case"name":h(!1);break;case"email":p(!1);break;case"body":w(!1)}"name"===s&&h(!1),U((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(g.a)({},s,n))}))};return Object(d.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:function(e){e.preventDefault(),o(!0);var n=L.name,i=L.email,l=L.body,r=!1;if(""!==n.trim()&&""!==n||(h(!0),r=!0),""!==i.trim()&&""!==i||(p(!0),r=!0),""!==l.trim()&&""!==l||(w(!0),r=!0),!r&&!1===b&&!1===x&&!1===E){var d=null===a||void 0===a?void 0:a.id;if(void 0!==d){var m={id:t.length+1,postId:d,name:n,email:i,body:l};f("/comments",m).then((function(){c((function(e){return[].concat(Object(y.a)(e),[m])}))}))}f("/users",{name:n,email:i}).then((function(e){null!==e&&s(e)})).finally((function(){U({name:"",email:"",body:"",postId:null===a||void 0===a?void 0:a.id}),o(!1)}))}},children:[Object(d.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(d.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(d.jsx)("input",{type:"text",name:"name",id:"comment-author-name",placeholder:"Name Surname",value:L.name,onChange:I,className:l()("input",{"is-danger":b})}),Object(d.jsx)("span",{className:"icon is-small is-left",children:Object(d.jsx)("i",{className:"fas fa-user"})}),b&&Object(d.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(d.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),b&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(d.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(d.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(d.jsx)("input",{type:"text",name:"email",id:"comment-author-email",placeholder:"email@test.com",value:L.email,onChange:I,className:l()("input",{"is-danger":x})}),Object(d.jsx)("span",{className:"icon is-small is-left",children:Object(d.jsx)("i",{className:"fas fa-envelope"})}),x&&Object(d.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(d.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),x&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(d.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("textarea",{id:"comment-body",name:"body",placeholder:"Type comment here",onChange:I,value:L.body,className:l()("textarea",{"is-danger":E})})}),E&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(d.jsxs)("div",{className:"field is-grouped",children:[Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("button",{type:"submit",className:l()("button","is-link",{"is-loading":i}),children:"Add"})}),Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:function(){U({name:"",email:"",body:"",postId:null===a||void 0===a?void 0:a.id})},children:"Clear"})})]})]})},E=function(){var e=u(),t=e.postSelected,s=e.setComments,c=e.errorComments,a=e.setErrorComments,i=e.isLoadingComments,o=e.setIsLoadingComments,l=e.comments,r=e.commentToDelete,m=e.setCommentToDelete,j=e.showForm,b=e.setShowForm;Object(n.useEffect)((function(){t&&(o(!0),b(!1),v("/comments?postId=".concat(null===t||void 0===t?void 0:t.id)).then((function(e){s(e)})).catch((function(){a("Error loading comments")})).finally((function(){o(!1)})))}),[t]);return Object(n.useEffect)((function(){x("/comments/".concat(null===r||void 0===r?void 0:r.id)).finally((function(){m(null)}))}),[r]),Object(d.jsx)("div",{className:"content","data-cy":"PostDetails",children:Object(d.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(d.jsxs)("div",{className:"block",children:[Object(d.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(null===t||void 0===t?void 0:t.id,": ").concat(null===t||void 0===t?void 0:t.title)}),Object(d.jsx)("p",{"data-cy":"PostBody",children:null===t||void 0===t?void 0:t.body})]}),Object(d.jsxs)("div",{className:"block",children:[i&&Object(d.jsx)(N,{}),c&&Object(d.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:c}),0===(null===l||void 0===l?void 0:l.length)&&!1===i&&Object(d.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),0!==(null===l||void 0===l?void 0:l.length)&&!1===i&&Object(d.jsx)("p",{className:"title is-4",children:"Comments:"}),0!==(null===l||void 0===l?void 0:l.length)&&!1===i&&(null===l||void 0===l?void 0:l.map((function(e){return Object(d.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(d.jsxs)("div",{className:"message-header",children:[Object(d.jsx)("a",{href:"mailto:misha@mate.academy","data-cy":"CommentAuthor",children:e.name}),Object(d.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){return function(e){if(m(e),null!==l){var t=l.filter((function(t){return t.id!==e.id}));s(t)}}(e)},children:"delete button"})]}),Object(d.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:e.body})]},e.id)}))),!1===i&&!1===j&&Object(d.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:function(){b(!0)},children:"Write a comment"})]}),!1===i&&j&&Object(d.jsx)(C,{})]})})},w=function(){var e=u(),t=e.users,s=e.setUsers,c=e.showUsers,a=e.setShowUsers,i=e.setUserSelected,o=e.setErrorUsers,l=Object(n.useRef)(null),m=Object(n.useState)("Choose a user"),j=Object(r.a)(m,2),b=j[0],h=j[1];return Object(n.useEffect)((function(){v("/users").then((function(e){s(e)})).catch((function(){o("Error loading users")}))}),[]),Object(n.useEffect)((function(){function e(e){l.current&&!l.current.contains(e.target)&&a(!1)}return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[]),Object(d.jsxs)("div",{"data-cy":"UserSelector",className:"dropdown is-active",ref:l,children:[Object(d.jsx)("div",{className:"dropdown-trigger",children:Object(d.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:function(){a(!c)},children:[Object(d.jsx)("span",{children:b}),Object(d.jsx)("span",{className:"icon is-small",children:Object(d.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),c&&Object(d.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",children:void 0!==t&&Object(d.jsx)("div",{className:"dropdown-content",children:null===t||void 0===t?void 0:t.map((function(e){return Object(d.jsx)("a",{href:"#user-".concat(e.id),className:"dropdown-item",onClick:function(){return function(e){i(e),a(!1),h(e.name)}(e)},children:e.name},e.id)}))})})]})},P=function(){var e=u(),t=e.errorPosts,s=e.userSelected,n=e.posts,c=e.isLoadingPosts,a=e.postSelected;return Object(d.jsx)("main",{className:"section",children:Object(d.jsx)("div",{className:"container",children:Object(d.jsxs)("div",{className:"tile is-ancestor",children:[Object(d.jsx)("div",{className:"tile is-parent",children:Object(d.jsxs)("div",{className:"tile is-child box is-success",children:[Object(d.jsx)("div",{className:"block",children:Object(d.jsx)(w,{})}),Object(d.jsxs)("div",{className:"block","data-cy":"MainContent",children:[!s&&Object(d.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),c&&Object(d.jsx)(N,{}),t&&Object(d.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:t}),0===(null===n||void 0===n?void 0:n.length)&&s&&!1===c&&Object(d.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"}),Object(d.jsx)(p,{})]})]})}),Object(d.jsx)("div",{"data-cy":"Sidebar",className:l()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":a}),children:Object(d.jsx)("div",{className:"tile is-child box is-success ",children:Object(d.jsx)(E,{})})})]})})})};i.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(j,{children:Object(d.jsx)(P,{})})}),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.f883fb0b.chunk.js.map